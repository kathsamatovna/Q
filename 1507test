Excellent â€” youâ€™re thinking about this exactly like a market microstructure analyst now.
Letâ€™s unpack carefully what you just said, because every detail changes how that plot behaves.


---

ğŸ§© What youâ€™re describing now

You said:

> I want to plot the difference from mid for each fill in a cluster,
against the cumulative total fill within that cluster,
and my clusters can have mixed buy/sell fills.



So for each cluster :

Sort its fills in time order.

Compute Î”price_i = execPrice_i âˆ’ midPrice_i for every fill i.

Compute X_i = cumulative sum of fillQty_i (within that cluster).

Plot Y = Î”price_i vs X = cumulative fill_i.


That gives a trajectory of how execution slippage evolves as that burst unfolds.


---

ğŸ’¡ Intuition for what youâ€™ll see

ğŸ”¸ If the cluster is mostly one-sided (e.g. a buy sweep):

Youâ€™ll get an upward-sloping, concave curve â€” the classic impact curve.

Î”Price â†‘
        |       .
        |    .
        |  .
        |.
        +----------------> Cumulative fill

The first fills are near mid (small deviation).

As more volume trades, the trader â€œwalks the book,â€ paying higher prices.

The curve often follows a square-root law:
.


ğŸ”¸ If the cluster switches sides (mixed buy/sell):

Youâ€™ll see zig-zag or looping trajectories â€” the average may hover near zero because buys and sells cancel in price impact.

Thatâ€™s expected for internalised or hedging bursts, not directional execution.


---

ğŸ§® How to code it (cluster by cluster)

import pandas as pd
import matplotlib.pyplot as plt

# assume df has: cluster, ts, fillQty, execPrice, midPrice, side
df = df.sort_values(["cluster", "ts"]).copy()
df["price_diff"] = df["execPrice"] - df["midPrice"]

# cumulative fill per cluster (absolute, so mixed sides still increase volume)
df["cum_fill"] = df.groupby("cluster")["fillQty"].cumsum()

fig, ax = plt.subplots(figsize=(7, 5))

for cluster_id, g in df.groupby("cluster"):
    ax.plot(g["cum_fill"], g["price_diff"], alpha=0.4)

ax.axhline(0, color="gray", lw=1, ls="--")
ax.set_xlabel("Cumulative fill within cluster")
ax.set_ylabel("Exec âˆ’ Mid price per fill")
ax.set_title("Intra-cluster impact trajectories")
plt.show()


---

âš™ï¸ Variants depending on what you want to see

Goal	Change

Compare direction	colour by side (BUY/SELL)
Normalise prices	plot price_diff / midPrice
Focus on impact magnitude	plot abs(price_diff)
See averaged pattern	aggregate by volume percentiles across clusters



---

ğŸ” Why this curve often looks exponential / concave

When plotted in linear scale, it looks exponential because early fills move the mid only slightly, then impact accelerates and saturates.
In theory and empirical studies, itâ€™s sublinear (square-root-like):

E[|\Delta P|] \propto V_\text{cum}^{\alpha}, \quad 0.4 \lesssim \alpha \lesssim 0.7

That concave curve is exactly what youâ€™ll recognise as the market impact function.
If you logâ€“log plot |Î”price| vs cum_fill, youâ€™ll get an almost straight line whose slope = Î±.


---

ğŸ”¹ Summary

Youâ€™re plotting intra-cluster market impact trajectories:

Quantity	Symbol	Description

X-axis		cumulative fill within the cluster
Y-axis		instantaneous slippage


And yes â€” if your clusters are mostly one-sided, youâ€™ll see that smooth, concave, almost-exponential rise in |Î”P| as cumulative fill increases.
If theyâ€™re mixed or hedged, youâ€™ll get noisy, symmetric loops around zero.


---

Would you like me to show how to overlay the average curve across all clusters (so you can quantify that Î± exponent)?

